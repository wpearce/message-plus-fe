<section class="page">
  <header class="hdr">
    @if (this.isNew) {
      <h1>Create message</h1>
    } @else {
      <h1>Edit message</h1>
    }
    <div class="spacer"></div>
    <button type="button" class="btn" (click)="cancel()">Cancel</button>
    <button type="button" class="btn primary" [disabled]="form.invalid || loading() || (!form.dirty && !tagsChanged())" (click)="save()">Save</button>
  </header>

  @if (loading()) {
    <div>Loadingâ€¦</div>
  } @else {
    @if (error()) {
      <div class="err">{{ error() }}</div>
    }

    <form [formGroup]="form" class="grid">
      <label class="field">
        <span class="lbl">Title</span>
        <input formControlName="title" />
      </label>

      <div class="field span-2">
        <mp-template-tagging
          [templateId]="id"
          [availableTags]="availableTags()"
          [selectedTagIds]="selectedTagIds()"
          (tagIdsUpdated)="onTagIdsUpdated($event)"
        ></mp-template-tagging>
      </div>

      <label class="field span-2">
        <div class="lbl-row">
          <span class="lbl">Body (EN)</span>
          <div class="ai-actions">
            <button type="button" class="btn sm ai-btn"
                    [disabled]="loading() || isAiBusy()"
                    (click)="translateEn()">
              @if (isTranslationEnBusy()) {
                <span class="spinner"></span>
              } @else {
                <span>Translate</span>
              }
            </button>
            <button type="button" class="btn sm ai-btn"
                    [disabled]="loading() || isAiBusy()"
                    (click)="improveEn()">
              @if (isImprovingEnBusy()) {
                <span class="spinner"></span>
              } @else {
                <span>Improve</span>
              }
            </button>
          </div>
        </div>
        <textarea formControlName="bodyEn" rows="6"></textarea>
      </label>

      <label class="field span-2">
        <div class="lbl-row">
          <span class="lbl">Body (PT)</span>
          <div class="ai-actions">
            <button type="button" class="btn sm ai-btn"
                    [disabled]="loading() || isAiBusy()"
                    (click)="translatePt()">
              @if (isTranslationPtBusy()) {
                <span class="spinner"></span>
              } @else {
                <span>Translate</span>
              }
            </button>
            <button type="button" class="btn sm ai-btn"
                    [disabled]="loading() || isAiBusy()"
                    (click)="improvePt()">
              @if (isImprovingPtBusy()) {
                <span class="spinner"></span>
              } @else {
                <span>Improve</span>
              }
            </button>
          </div>
        </div>
        <textarea formControlName="bodyPt" rows="6"></textarea>
      </label>

    </form>
  }
</section>
